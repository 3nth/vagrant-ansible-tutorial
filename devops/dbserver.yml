---

- hosts: dbservers
  sudo: True
  user: vagrant

  tasks:
    - name: update apt
      action: command /usr/bin/apt-get update

    - name: install db server packages
      action: apt pkg=$item state=present
      with_items:
        - postgresql
        - postgresql-contrib
        - libpq-dev
        - python-dev
        - python-setuptools

    - name: install python libraries
      action: easy_install name=psycopg2==2.4.5

    - name: add postgres user to admin group
      action: user name=postgres groups=admin append=yes password=vagrant


- hosts: dbservers
  sudo: True
  user: vagrant
  sudo_user: postgres

  tasks:
    - name: create a test database user
      action: postgresql_user user=vagrant password=password

    - name: create test database
      action: postgresql_db name=vagrant_ansible_tutorial owner=vagrant
